<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏ - –ò–≥—Ä–∞</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <button class="back-btn" id="backBtn">‚Üê –ù–∞–∑–∞–¥</button>
            <h1 id="gameTitle">–ë—ã—Å—Ç—Ä–∞—è –∏–≥—Ä–∞</h1>
            <div class="game-info">
                <div class="player-info">
                    <span>–í—ã: <strong id="currentPlayer">X</strong></span>
                    <span id="opponentInfo"></span>
                </div>
            </div>
        </div>

        <div class="game-board" id="gameBoard">
            <div class="cell" data-index="0"></div>
            <div class="cell" data-index="1"></div>
            <div class="cell" data-index="2"></div>
            <div class="cell" data-index="3"></div>
            <div class="cell" data-index="4"></div>
            <div class="cell" data-index="5"></div>
            <div class="cell" data-index="6"></div>
            <div class="cell" data-index="7"></div>
            <div class="cell" data-index="8"></div>
        </div>

        <div class="game-status">
            <div id="statusMessage">–í–∞—à —Ö–æ–¥!</div>
            <button class="restart-btn" id="restartBtn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        </div>
    </div>

    <script>
        // –ü—Ä–æ—Å—Ç–∞—è –∏–≥—Ä–∞ —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Game board loaded - Computer mode');
            
            let currentPlayer = 'X';
            let gameBoard = ['', '', '', '', '', '', '', '', ''];
            let gameActive = true;
            
            const cells = document.querySelectorAll('.cell');
            const statusMessage = document.getElementById('statusMessage');
            const gameType = localStorage.getItem('gameType') || 'player';
            
            console.log('Game type:', gameType);
            console.log('Cells found:', cells.length);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –∏–≥—Ä—ã —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º
            if (gameType === 'computer') {
                const gameTitle = document.getElementById('gameTitle');
                if (gameTitle) gameTitle.textContent = '–ò–≥—Ä–∞ —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º';
                
                const opponentType = document.getElementById('opponentType');
                if (opponentType) opponentType.textContent = ' vs ü§ñ –ö–æ–º–ø—å—é—Ç–µ—Ä';
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ —è—á–µ–π–∫–∞–º
            cells.forEach(cell => {
                cell.addEventListener('click', function(e) {
                    if (!gameActive) return;
                    
                    const index = parseInt(e.target.getAttribute('data-index'));
                    console.log('Cell clicked:', index, 'Current player:', currentPlayer);
                    
                    // –ï—Å–ª–∏ –∏–≥—Ä–∞ —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º –∏ –Ω–µ —Ö–æ–¥ –∏–≥—Ä–æ–∫–∞ - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
                    if (gameType === 'computer' && currentPlayer !== 'X') {
                        console.log('Not player turn');
                        return;
                    }
                    
                    if (gameBoard[index] !== '') {
                        console.log('Cell already occupied');
                        return;
                    }
                    
                    // –•–æ–¥ –∏–≥—Ä–æ–∫–∞
                    gameBoard[index] = currentPlayer;
                    e.target.textContent = currentPlayer;
                    e.target.classList.add(currentPlayer.toLowerCase());
                    console.log('Player moved to:', index);
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã
                    if (checkWin()) {
                        gameActive = false;
                        statusMessage.textContent = `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! ${currentPlayer} –ø–æ–±–µ–¥–∏–ª!`;
                        highlightWinningCells();
                        console.log('Player won!');
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∏—á—å–∏
                    if (checkDraw()) {
                        gameActive = false;
                        statusMessage.textContent = '–ù–∏—á—å—è!';
                        console.log('Draw!');
                        return;
                    }
                    
                    // –ï—Å–ª–∏ –∏–≥—Ä–∞ —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º - —Ö–æ–¥ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
                    if (gameType === 'computer') {
                        currentPlayer = 'O';
                        statusMessage.textContent = '–•–æ–¥ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞...';
                        console.log('Computer turn started');
                        
                        // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–ª–µ –Ω–∞ –≤—Ä–µ–º—è —Ö–æ–¥–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
                        lockGameBoard();
                        
                        setTimeout(() => {
                            makeComputerMove();
                        }, 1000);
                    } else {
                        // –õ–æ–∫–∞–ª—å–Ω–∞—è –∏–≥—Ä–∞ - –ø—Ä–æ—Å—Ç–æ –º–µ–Ω—è–µ–º –∏–≥—Ä–æ–∫–∞
                        currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                        statusMessage.textContent = `–•–æ–¥ –∏–≥—Ä–æ–∫–∞ ${currentPlayer}`;
                    }
                });
            });
            
            function makeComputerMove() {
                console.log('Computer thinking...');
                console.log('Current board:', gameBoard);
                
                if (!gameActive) return;
                
                // –ü—Ä–æ—Å—Ç–æ–π AI
                let move = findWinningMove('O') || findWinningMove('X') || findRandomMove();
                
                console.log('Computer chose move:', move);
                
                // –ï—Å–ª–∏ —Ö–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—â–µ–º –ø–µ—Ä–≤—É—é –ø—É—Å—Ç—É—é —è—á–µ–π–∫—É
                if (move === -1) {
                    console.log('Fallback: finding first empty cell');
                    for (let i = 0; i < gameBoard.length; i++) {
                        if (gameBoard[i] === '') {
                            move = i;
                            break;
                        }
                    }
                }
                
                if (move !== -1 && gameBoard[move] === '') {
                    gameBoard[move] = 'O';
                    const cell = document.querySelector(`.cell[data-index="${move}"]`);
                    cell.textContent = 'O';
                    cell.classList.add('o');
                    
                    console.log('Computer moved to:', move);
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
                    if (checkWin()) {
                        gameActive = false;
                        statusMessage.textContent = '–ö–æ–º–ø—å—é—Ç–µ—Ä –ø–æ–±–µ–¥–∏–ª!';
                        highlightWinningCells();
                        console.log('Computer won!');
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∏—á—å–∏
                    if (checkDraw()) {
                        gameActive = false;
                        statusMessage.textContent = '–ù–∏—á—å—è!';
                        console.log('Draw!');
                        return;
                    }
                    
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ö–æ–¥ –∏–≥—Ä–æ–∫—É
                    currentPlayer = 'X';
                    statusMessage.textContent = '–í–∞—à —Ö–æ–¥!';
                    unlockGameBoard();
                    console.log('Player turn again');
                } else {
                    console.log('No valid move found! Board:', gameBoard);
                }
            }
            
            function findWinningMove(player) {
                const winPatterns = [
                    [0, 1, 2], [3, 4, 5], [6, 7, 8],
                    [0, 3, 6], [1, 4, 7], [2, 5, 8],
                    [0, 4, 8], [2, 4, 6]
                ];
                
                for (let pattern of winPatterns) {
                    const [a, b, c] = pattern;
                    let playerCount = 0;
                    let emptyIndex = -1;
                    
                    if (gameBoard[a] === player) playerCount++;
                    else if (gameBoard[a] === '') emptyIndex = a;
                    
                    if (gameBoard[b] === player) playerCount++;
                    else if (gameBoard[b] === '') emptyIndex = b;
                    
                    if (gameBoard[c] === player) playerCount++;
                    else if (gameBoard[c] === '') emptyIndex = c;
                    
                    if (playerCount === 2 && emptyIndex !== -1) {
                        console.log(`Found ${player === 'O' ? 'winning' : 'blocking'} move:`, emptyIndex);
                        return emptyIndex;
                    }
                }
                return -1;
            }
            
            function findRandomMove() {
                const emptyCells = [];
                for (let i = 0; i < gameBoard.length; i++) {
                    if (gameBoard[i] === '') {
                        emptyCells.push(i);
                    }
                }
                
                console.log('Empty cells for random move:', emptyCells);
                
                if (emptyCells.length > 0) {
                    const randomIndex = Math.floor(Math.random() * emptyCells.length);
                    console.log('Random index:', randomIndex, 'Selected move:', emptyCells[randomIndex]);
                    return emptyCells[randomIndex];
                }
                
                console.log('No empty cells found!');
                return -1;
            }
            
            function lockGameBoard() {
                cells.forEach(cell => {
                    cell.style.pointerEvents = 'none';
                });
            }
            
            function unlockGameBoard() {
                cells.forEach(cell => {
                    cell.style.pointerEvents = 'auto';
                });
            }
            
            function checkWin() {
                const winPatterns = [
                    [0, 1, 2], [3, 4, 5], [6, 7, 8],
                    [0, 3, 6], [1, 4, 7], [2, 5, 8],
                    [0, 4, 8], [2, 4, 6]
                ];
                
                return winPatterns.some(pattern => {
                    const [a, b, c] = pattern;
                    return gameBoard[a] !== '' && 
                           gameBoard[a] === gameBoard[b] && 
                           gameBoard[a] === gameBoard[c];
                });
            }
            
            function checkDraw() {
                return gameBoard.every(cell => cell !== '');
            }
            
            function highlightWinningCells() {
                const winPatterns = [
                    [0, 1, 2], [3, 4, 5], [6, 7, 8],
                    [0, 3, 6], [1, 4, 7], [2, 5, 8],
                    [0, 4, 8], [2, 4, 6]
                ];
                
                for (let pattern of winPatterns) {
                    const [a, b, c] = pattern;
                    if (gameBoard[a] !== '' && gameBoard[a] === gameBoard[b] && gameBoard[a] === gameBoard[c]) {
                        pattern.forEach(index => {
                            const cell = document.querySelector(`.cell[data-index="${index}"]`);
                            if (cell) cell.classList.add('winner');
                        });
                        break;
                    }
                }
            }
            
            // –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
            const restartBtn = document.getElementById('restartBtn');
            if (restartBtn) {
                restartBtn.addEventListener('click', function() {
                    gameBoard = ['', '', '', '', '', '', '', '', ''];
                    gameActive = true;
                    currentPlayer = 'X';
                    
                    cells.forEach(cell => {
                        cell.textContent = '';
                        cell.className = 'cell';
                        cell.style.pointerEvents = 'auto';
                    });
                    
                    statusMessage.textContent = '–í–∞—à —Ö–æ–¥!';
                    
                    if (gameType === 'computer' && currentPlayer === 'O') {
                        setTimeout(() => {
                            makeComputerMove();
                        }, 500);
                    }
                });
            }

            // –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥
            const backBtn = document.getElementById('backBtn');
            if (backBtn) {
                backBtn.addEventListener('click', function() {
                    window.location.href = 'game.html';
                });
            }
        });
    </script>
</body>
</html>
